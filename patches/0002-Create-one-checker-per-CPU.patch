From 354c6ff143c1aff7ebfbd41635c07dac6672be30 Mon Sep 17 00:00:00 2001
From: auvred <aauvred@gmail.com>
Date: Wed, 18 Jun 2025 15:24:43 +0300
Subject: [PATCH 2/4] Create one checker per CPU

---
 internal/compiler/program.go | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/internal/compiler/program.go b/internal/compiler/program.go
index 1e159fd49..fad344ba0 100644
--- a/internal/compiler/program.go
+++ b/internal/compiler/program.go
@@ -4,6 +4,7 @@ import (
 	"context"
 	"fmt"
 	"maps"
+	"runtime"
 	"slices"
 	"strings"
 	"sync"
@@ -222,7 +223,7 @@ func (p *Program) initCheckerPool() {
 	if p.opts.CreateCheckerPool != nil {
 		p.checkerPool = p.opts.CreateCheckerPool(p)
 	} else {
-		p.checkerPool = newCheckerPool(core.IfElse(p.SingleThreaded(), 1, 4), p)
+		p.checkerPool = newCheckerPool(core.IfElse(p.SingleThreaded(), 1, runtime.GOMAXPROCS(0)), p)
 	}
 }
 
-- 
2.49.0

